let gridSize,containerSize,score,gameStatus,playMethod,valueToColor,autoplayLastMoveTime,autoplayDuration,totalMoves,moveSound,menubackground,playbackground,ggbackground,checkingGameOver,grid=[];function preload(){soundFormats("mp3"),moveSound=loadSound("assets/pop"),menubackground=loadImage("assets/background-1.jpg"),playbackground=loadImage("assets/background-2.jpg"),ggbackground=loadImage("assets/background-3.jpg")}function setup(){createCanvas(windowWidth,windowHeight),score=0,totalMoves=0,gameStatus="menu",valueToColor=new Map([[0,"white"],[2,"#fafcc2"],[4,"#ffd57e"],[8,"#fca652"],[16,"#d9adad"],[32,"#eb6383"],[64,"#d63447"],[128,"#b2ebf2"],[256,"#00bcd4"],[512,"#008dd4"],[1024,"#88e868"]]);for(let e=0;e<15;++e)valueToColor.set(2048*Math.pow(2,e),"#2e5a1c")}function draw(){"menu"===gameStatus?(background(menubackground),displayMenu()):"play"===gameStatus&&(background(playbackground),drawGrid(),"auto"===playMethod&&autoplay(),displayScore(),checkingGameOver||checkGameOver()),"gg"===gameStatus&&(background(ggbackground),gameOverScreen())}function initGrid(){grid=[];let e=floor(random()*gridSize),t=floor(random()*gridSize);for(let i=0;i<gridSize;++i){grid.push([]);for(let o=0;o<gridSize;++o){let r={value:i===e&&o===t?2:0};grid[i].push(r)}}}function drawGrid(){containerSize=min(width/5*3,height/10*9),fill(0,0,0),rect(width/20,height/20,containerSize,containerSize,20);let e=width/20+containerSize/100*3,t=height/20+containerSize/100*3,i=width/20+containerSize/100*97,o=height/20+containerSize/100*97,r=(i-e)/gridSize,l=(o-t)/gridSize;textAlign(CENTER,CENTER),textSize(.3*r);for(let i=0;i<gridSize;++i)for(let o=0;o<gridSize;++o)fill(valueToColor.get(grid[i][o].value)),rect(e+r*o,t+l*i,r,l,10),fill(0),grid[i][o].value>0&&text(grid[i][o].value,e+r*(o+.5),t+l*(i+.5))}function keyPressed(){"play"===gameStatus&&"manual"===playMethod&&("w"!==key&&"W"!==key&&keyCode!==UP_ARROW||oneRound("w"),"s"!==key&&"S"!==key&&keyCode!==DOWN_ARROW||oneRound("s"),"a"!==key&&"A"!==key&&keyCode!==LEFT_ARROW||oneRound("a"),"d"!==key&&"D"!==key&&keyCode!==RIGHT_ARROW||oneRound("d"))}function mousePressed(){if("menu"===gameStatus){if(mouseX>=50&&mouseX<=width-50&&mouseY>=200&&mouseY<=300){let e=/^(1[0-2]|[2-9])$/;for(gridSize=0;!e.test(gridSize);)gridSize=window.prompt("Please enter the grid size from 2-12:");initGrid(),gameStatus="play",playMethod="manual"}if(mouseX>=50&&mouseX<=width-50&&mouseY>=400&&mouseY<=500){let e=/^(1[0-2]|[2-9])$/,t=/^([1-9][0-9]|[1-9][0-9][0-9]|[1-9][0-9][0-9][0-9])$/;for(gridSize=0,autoplayDuration=0;!e.test(gridSize);)gridSize=Number(window.prompt("Please enter the grid size from 2-12:"));for(;!t.test(autoplayDuration);)autoplayDuration=Number(window.prompt("Please enter the auto play duration in ms from 10-9999:"));initGrid(),gameStatus="play",playMethod="auto",autoplayLastMoveTime=millis()}}"gg"===gameStatus&&mouseX>=100&&mouseX<=width-100&&mouseY>=500&&mouseY<=600&&setup()}function oneRound(e){let t=!1;return t|=moveAllCells(e),t|=mergeAllCells(e),t|=moveAllCells(e),"play"===gameStatus&&t&&(totalMoves++,moveSound.play(),generateRandomCell()),t}function moveAllCells(e){let t=!1;if("w"===e)for(let e=0;e<gridSize;++e)for(let i=0;i<gridSize;++i)t|=moveCurrentCell(i,e,1,0);if("s"===e)for(let e=gridSize-1;e>=0;--e)for(let i=0;i<gridSize;++i)t|=moveCurrentCell(i,e,-1,0);if("a"===e)for(let e=0;e<gridSize;++e)for(let i=0;i<gridSize;++i)t|=moveCurrentCell(i,e,0,1);if("d"===e)for(let e=0;e<gridSize;++e)for(let i=gridSize-1;i>=0;--i)t|=moveCurrentCell(i,e,0,-1);return t}function mergeAllCells(e){let t=!1;if("w"===e)for(let e=0;e<gridSize-1;++e)for(let i=0;i<gridSize;++i)t|=mergeCurrentCell(i,e,-1,0);if("s"===e)for(let e=gridSize-1;e>=1;--e)for(let i=0;i<gridSize;++i)t|=mergeCurrentCell(i,e,1,0);if("a"===e)for(let e=0;e<gridSize;++e)for(let i=0;i<gridSize-1;++i)t|=mergeCurrentCell(i,e,0,-1);if("d"===e)for(let e=0;e<gridSize;++e)for(let i=gridSize-1;i>=1;--i)t|=mergeCurrentCell(i,e,0,1);return t}function moveCurrentCell(e,t,i,o){if(0===grid[t][e].value)return!1;let r=e-o,l=t-i;for(;l>=0&&r>=0&&l<gridSize&&r<gridSize&&0===grid[l][r].value;)[grid[l][r],grid[l+i][r+o]]=[grid[l+i][r+o],grid[l][r]],l-=i,r-=o;return r===e-o&&l===t-i||console.log("moved a cell at ("+e+","+t+")"),r!==e-o||l!==t-i}function mergeCurrentCell(e,t,i,o){return 0!==grid[t][e].value&&(grid[t-i][e-o].value===grid[t][e].value&&(grid[t][e].value*=2,grid[t-i][e-o].value=0,score+=grid[t][e].value,console.log("merged two cells at ("+e+","+t+"), created a cell with value of "+grid[t][e].value),!0))}function generateRandomCell(){let e,t,i,o=[];for(let e=0;e<gridSize;++e)for(let t=0;t<gridSize;++t)0===grid[e][t].value&&o.push([t,e]);[e,t]=random(o),i=random(100)<90?2:4,grid[t][e].value=i,console.log("generated a new cell with value of "+i+" at ("+e+","+t+")")}function displayScore(){fill(255),textSize(width/35),text("Score: "+score,width-200,60),text("Moves: "+totalMoves,width-200,300),textSize(width/100),text("When you start the game, there will be a two tile on the grid,",width-300,500),text("You hit the arrow keys on your keyboard to move the tiles around",width-300,520),text(" â€” and also to generate new tiles, which will also be valued at 2 or 4.",width-300,540),text(" When two equal tiles collide, they combine to give you one ",width-300,560),text("greater tile that displays their sum. The more you do this,",width-350,580),text("the higher the tiles get and the more crowded the board becomes.",width-400,600),text("Your objective is to reach 4096 before the board fills up. ",width-300,620),text("You can check console to check your activities log.",width-300,640)}function checkGameOver(){checkingGameOver=!0;let e=[-1,0,1,0,-1];for(let t=0;t<gridSize;++t)for(let i=0;i<gridSize;++i){if(0===grid[t][i].value)return checkingGameOver=!1,!1;for(let o=0;o<4;++o)if(t+e[o]>=0&&t+e[o]<gridSize&&i+e[o+1]>=0&&i+e[o+1]<gridSize&&grid[t+e[o]][i+e[o+1]].value===grid[t][i].value)return checkingGameOver=!1,!1}window.setTimeout(function(){return checkingGameOver=!1,gameStatus="gg",!0},1e3),checkingGameOver=!1}function displayMenu(){fill("white"),textSize(width/15),textAlign(LEFT),text("4096!",width/2-width/15,100),fill("white"),rect(50,200,width-100,100),textSize(width/30),textAlign(CENTER,CENTER),fill("black"),text("Play",width/2,250),fill("white"),rect(50,400,width-100,100),fill("black"),text("Auto Play",width/2,450)}function autoplay(){if("play"===gameStatus&&autoplayLastMoveTime+autoplayDuration<millis()){oneRound(random(["a","w","s","d"]))&&(autoplayLastMoveTime=millis())}}function gameOverScreen(){let e=0;for(let t=0;t<gridSize;++t)for(let i=0;i<gridSize;++i)e=e>grid[t][i].value?e:grid[t][i].value;textSize(width/15),textAlign(CENTER,CENTER),text("Game Over!",width/2,100),textSize(width/30),text("Your score is "+score,width/2,200),text("The highest tile you got is "+e,width/2,300),text("Your total moves is "+totalMoves,width/2,400),fill("white"),rect(100,500,width-200,100),fill("black"),text("Restart",width/2,550)}